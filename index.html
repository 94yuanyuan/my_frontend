<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>倉儲系統首頁</title>
  <script src="https://unpkg.com/petite-vue" defer init></script>
</head>
<body>
  <h1>歡迎使用我的倉儲系統</h1>
  <p>此網站尚在開發中...</p>

  <div v-scope="{
    page: 'login',
    username: '',
    password: '',
    message: '',
	isTestMode: new URLSearchParams(location.search).get('testMode') === '1',
    async login() {
      try {
		// 判斷是否進入測試模式
		const url = this.isTestMode
          ? 'https://my-backend-9pkr.onrender.com/404' // 模擬錯誤網址
          : 'https://my-backend-9pkr.onrender.com/login';
		
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
		    username: this.username.trim(),
			password: this.password
		  })
        });
		// 捕捉連線錯誤、CORS 問題
		if(!res.ok){
			this.message = `伺服器錯誤 (${res.status})，請稍後再試`;
			return;
		}
		
        const result = await res.json();
        this.message = result.message;
		
        if (result.success) {
		  this.password = '';
          this.page = 'dashboard';
        }
		
      } catch (err) {
		// 捕捉 API 拋出的錯誤
        this.message = '無法連線到伺服器，請檢查網路或稍後再試';
        console.error('發生錯誤:', err);
      }
    },
	
	logout() {
	  this.username = '';
	  this.password = '';
	  this.message = '';
	  this.page = 'login';
	}
  }">
  
    <template v-if="page === 'login'">
      <h2>登入系統 <small v-if="isTestMode">(測試模式)</small></h2>
      <input v-model="username" type="text" placeholder="帳號" /><br />
      <input v-model="password" type="password" placeholder="密碼" /><br />
      <button @click="login" :disabled="!username || !password">登入</button>
      <p style="color:red">{{ message }}</p>
    </template>

    <template v-if="page === 'dashboard'">
      <h2>歡迎 {{ username }}</h2>
      <button @click="logout">登出</button>
    </template>

  </div>
</body>
</html>